function loadCalendar(){setUserName();var e=[{name:LOG_OUT_STRING,action:logout}],a=JSON.parse(decodeURIComponent(getCookieValue("racecourse-id"))),c=document.querySelector("#calendar-class"),d=!0,l=new Date;makeRequest("GET","/api/class-user",{user_id:a.user},function(e){var a=JSON.parse(e).items;d=!0;for(var t=0;t<a.length;t++)a[t].is_admin&&(d=!1);function r(){if(0==--s){for(var e=Object.keys(i).sort(),a=0;a<e.length;a++)c.appendChild(i[e[a]]);o&&createToast(DEFAULT_ERROR),generateCalendar(d,l)}}for(var n,s=a.length,o=!1,i={},t=0;t<a.length;t++)n=a[t],makeRequest("GET","/api/class",{id:n.class_id},function(e){var a=JSON.parse(e),t=document.createElement("option");t.innerHTML=a.items[0].name,t.value=a.items[0].id,i[a.items[0].name]=t,r()},function(){o=!0,r()})},function(e){var a=DEFAULT_ERROR;try{var t=JSON.parse(e);t.errorMessage&&(a=t.errorMessage)}catch(e){}createToast(a)}),c.onchange=function(){generateCalendar(d,l)},document.querySelector("#calendar-next-button").onclick=function(){l.setDate(l.getDate()+7),generateCalendar(d,l)},document.querySelector("#calendar-previous-button").onclick=function(){l.setDate(l.getDate()-7),generateCalendar(d,l)},setActionButtons(e)}function generateCalendar(g,f){for(var m=JSON.parse(decodeURIComponent(getCookieValue("racecourse-id"))),v=g?document.querySelector("#calendar-class").value:"",p=[],e=5;e<=22;e++){var a=new Date((new Date).toDateString());a.setHours(e),p.push({value:a.toTimeString().replace(/\s.*$/,""),display:12<=e?(e-12?e-12:12)+" PM":(e||12)+" AM"})}var t=[];t.push(f);for(var r=f.getDay(),e=r-1;0<=e;e--){(n=new Date(t[0])).setDate(n.getDate()-1),t.unshift(n)}for(var n,e=r+1;e<7;e++){(n=new Date(t[t.length-1])).setDate(n.getDate()+1),t.push(n)}for(var s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=[],e=0;e<t.length;e++)D.push({value:t[e].toDateString(),display:s[e]+" "+(t[e].getMonth()+1)+"/"+t[e].getDate()+"/"+t[e].getFullYear()});makeRequest("GET","/api/meeting",{student:g?1:"",class_id:v,user_id:m.user},function(e){var a=JSON.parse(e).items,t=document.createElement("table");t.setAttribute("cellspacing","0");for(var r=0;r<p.length+1;r++){for(var n=document.createElement("tr"),s=0;s<D.length+1;s++){var o=document.createElement(r&&s?"td":"th");if(!r&&s)o.innerHTML=D[s-1].display;else if(r&&!s)o.innerHTML=p[r-1].display;else if(r&&s){var i=D[s-1].value+" "+p[r-1].value,c=new Date(i),d=new Date(c);d.setHours(d.getHours()+1),c<new Date&&o.classList.add("solid");for(var l=null,u=0;u<a.length;u++)if(new Date(a[u].start_date)<d&&new Date(a[u].end_date)>c){o.classList.add("taken"),o.innerText=a[u].name?a[u].name:a[u].first+" "+a[u].last,g&&a[u].class_id!=v&&o.classList.add("solid"),l=a[u];break}o.classList.contains("solid")||(o.onclick=function(a,t,r){return function(){if(r)makeRequest("DELETE","/api/meeting",{id:r.id,class_id:r.class_id},function(){createToast("Meeting deleted."),generateCalendar(g,f)},function(e){var a=DEFAULT_ERROR;try{var t=JSON.parse(e);t.errorMessage&&(a=t.errorMessage)}catch(e){}createToast(a)});else{var e=document.querySelector("#calendar-class").value;if(!e)return void createToast("Please select a class.");makeRequest("POST","/api/meeting",{start_date:a.toString(),end_date:t.toString(),class_id:e,user_id:m.user,student:g},function(){createToast("Meeting added."),generateCalendar(g,f)},function(e){var a=DEFAULT_ERROR;try{var t=JSON.parse(e);t.errorMessage&&(a=t.errorMessage)}catch(e){}createToast(a)})}}}(c,d,l))}n.appendChild(o)}t.appendChild(n)}document.querySelector("table").replaceWith(t)},function(e){var a=DEFAULT_ERROR;try{var t=JSON.parse(e);t.errorMessage&&(a=t.errorMessage)}catch(e){}createToast(a)})}window.addEventListener("DOMContentLoaded",loadCalendar);