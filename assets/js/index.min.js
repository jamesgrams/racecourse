var LOG_OUT_STRING="Logout",loadedJs={},defaultError="Sorry, an error has ocurred.";function enableAjaxLinks(){document.querySelectorAll(".ajax-link").forEach(function(t){t.onclick=function(e){e.preventDefault(),directPage(t.getAttribute("href"))}})}function directPage(r){makeRequest("GET",r,{ajax:1,webp:!!document.querySelector(".webp")},function(e){try{var t=JSON.parse(e);changePage(t.content,t.title,t.description,t.js,t.css,r)}catch(e){console.log(e),window.location=r}})}function createCacheObjectFromFullPage(){for(var e=document.querySelectorAll("script[src]"),t=[],r=0;r<e.length;r++)t.push(e[r].getAttribute("src")),loadedJs[e[r].getAttribute("src")]=!0;for(var n=document.querySelectorAll("link[type='text/css']"),o=[],r=0;r<n.length;r++)o.push(n[r].getAttribute("href"));return{content:document.querySelector("#content-wrapper").innerHTML,title:document.title,description:document.querySelector('meta[name="description"]').getAttribute("content"),js:t,css:o}}function changePage(e,t,r,n,o,i,a){for(var c=[],s=0;s<o.length;s++){document.querySelector("link[href='"+o[s]+"']")||((u=document.createElement("link")).setAttribute("rel","stylesheet"),u.setAttribute("type","text/css"),u.setAttribute("href",o[s]),c.push(u))}if(c.length)for(var l=c.length,s=0;s<c.length;s++){var u=c[s];document.getElementsByTagName("head")[0].appendChild(u),u.onload=function(){0==--l&&switchPage(e,t,r,n,o,i,a)}}else switchPage(e,t,r,n,o,i,a)}function switchPage(e,t,r,n,o,i,a){clearPageSpecificJS(),document.querySelector("#content-wrapper").innerHTML=e,document.title=t||"",document.querySelector('meta[name="description"]').setAttribute("content",r||""),a||window.history.pushState({content:e,title:t,description:r,js:n,css:o},t,i),addPageSpecificJS(n),enableAjaxLinks(),window.scrollTo(0,0),document.querySelector("body").setAttribute("data-path",i)}function addPageSpecificJS(e){var o=e.length,i=[];e.forEach(function(t){var r=t.match(/\/([a-z]+)\.min/)[1];r="load"+(r=r[0].toUpperCase()+r.slice(1));function e(){if(i.push(function(){try{window[r](),loadedJs[t]=!0}catch(e){}}),0==--o)for(var e=0;e<i.length;e++)i[e]()}var n;loadedJs[t]?e():((n=document.createElement("script")).src=t,n.onload=e,document.body.appendChild(n))})}function addFormInputEvents(t){t.querySelectorAll("input, textarea").forEach(function(e){e.value&&e.classList.add("value"),e.oninput=function(){this.value?e.classList.add("value"):e.classList.remove("value"),formErrorCheck(t,!0)},e.onfocus=function(){e.classList.add("looked-at")},e.onblur=function(){formErrorCheck(t,!0)}})}function formSubmit(e,n,o,t,i){e.preventDefault(),formErrorCheck(n,!1);var r=n.querySelector("input.invalid");if(r)return r.focus(),void document.querySelector("form").reportValidity();var a=n.querySelector("button:not(.close-modal)"),c=a.innerText;a.onclick=function(e){e.preventDefault()};var s=(new Date).getTime();a.classList.add("submitting");var l=setTimeout(function(){a.innerText="Submitting!"},1e3);if(!t){t={};for(var u=n.querySelectorAll("input,textarea"),d=0;d<u.length;d++)t[u[d].getAttribute("name")]=u[d].value}makeRequest("POST",n.getAttribute("data-endpoint"),t,function(e){var t=((new Date).getTime()-s)%2e3,r=1e3;clearTimeout(l),r<t&&(r+=2e3),setTimeout(function(){a.classList.remove("submitting"),a.classList.add("submitted"),a.innerText="Thank You!",i&&i(e),o&&directPage(o)},r-t)},function(e){a.onclick=function(e){formSubmit(e,n,o,null,i)},a.innerText=c,a.classList.remove("submitting"),clearTimeout(l);var t="An error has occurred. Please try again later.";try{var r=JSON.parse(e);r.errorMessage&&(t=r.errorMessage)}catch(e){}formDisplayError(n,t)})}function ensureProperFixedElementColor(e,t){for(var r=!1,n=document.elementsFromPoint(Math.floor(e.getBoundingClientRect().left)+e.clientWidth/2,Math.floor(e.getBoundingClientRect().top)+e.clientHeight/2),o=t;o<n.length;o++){var i=window.getComputedStyle(n[o],null).getPropertyValue("background-color").match(/rgba?\((\d+), (\d+), (\d+),?\s?(0?\.?\d+)?\)/);if(i&&"0"!=i[4]){200<parseInt(i[1])&&200<parseInt(i[2])&&200<parseInt(i[3])&&(e.classList.add("dark"),r=!0);break}}r||e.classList.remove("dark")}function getConsistentPath(e){return"/"==e.substring(e.length-1)&&1<e.length?e.substring(0,e.length-1):e}function clearPageSpecificJS(){try{window.removeEventListener("wheel",sectionScrollWheel,{passive:!1}),window.removeEventListener("touchstart",recordStartPosition,{passive:!1}),window.removeEventListener("touchmove",recordPosition,{passive:!1}),window.removeEventListener("touchend",sectionScrollTouch,{passive:!1})}catch(e){}window.onkeydown=null,document.body.onscroll=null}function formErrorCheck(e,t){var r="input, textarea";t&&(r="input.looked-at, textarea.looked-at");var n,o=e.querySelectorAll(r),i={required:[],pattern:[]},a=!1;o.forEach(function(e){t||e.classList.add("looked-at"),e.hasAttribute("required")&&!e.value?(t||i.required.push(e.nextSibling.innerText),a=!0,e.classList.add("invalid"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby","form-error-message")):e.hasAttribute("pattern")&&!new RegExp(e.getAttribute("pattern")).test(e.value)?(t||i.pattern.push(e.nextSibling.innerText),a=!0,e.classList.add("invalid"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby","form-error-message")):(e.classList.remove("invalid"),e.setAttribute("aria-invalid","false"),e.removeAttribute("aria-describedby"))}),a?t||(n=[],i.required.length&&n.push("Please include a "+grammaticalJoin(i.required)+"."),i.pattern.length&&n.push("Please use a valid "+grammaticalJoin(i.pattern)+"."),formDisplayError(e,grammaticalJoinSentances(n))):formClearError(e)}function grammaticalJoinSentances(e){for(var t=["Also","Additionally","Furthermore"],r=t,n=1;n<e.length;n++){0==r.length&&(r=t),e[n]=e[n].replace(/^\w/,function(e){return e.toLowerCase()});var o=Math.floor(Math.random()*r.length);e[n]=r[o]+", "+e[n],r.splice(o,1)}return e.join(" ")}function grammaticalJoin(e,t){if(!t)for(var r=0;r<e.length;r++)e[r]=e[r].toLowerCase();if(e.length)return 1==e.length?e[0]:2==e.length?e[0]+" and "+e[1]:(e[e.length-1]="and "+e[e.length-1],e.join(", "))}function formDisplayError(e,t){formClearError(e);var r=document.createElement("div");r.setAttribute("id","form-error-message"),r.setAttribute("aria-live","polite"),r.classList.add("error"),r.innerText=t,e.insertBefore(r,e.querySelector("button:not(.close-modal)"))}function formClearError(e){var t=e.querySelector(".error");t&&t.parentNode.removeChild(t)}function setActionButtons(e){var t=document.querySelector(".buttons");t.innerHTML="";for(var r=0;r<e.length;r++){var n=document.createElement("button");n.innerText=e[r].name,n.onclick=e[r].action,t.appendChild(n)}}function setUserName(e){try{if(e)throw new Error;var t=JSON.parse(decodeURIComponent(getCookieValue("racecourse-id")));document.querySelector(".user-name").innerText=t.first+" "+t.last}catch(e){document.querySelector(".user-name").innerText="",console.log(e)}}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function logout(){deleteCookies(),window.location="/login"}function isInViewport(e){var t=e.getBoundingClientRect();return 0<=t.top&&0<=t.left&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function getCookieValue(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}function deleteCookies(){document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})}function makeRequest(e,t,r,n,o,i){var a=Object.keys(r);if(("GET"==e||"DELETE"==e)&&a.length){for(var c=[],s=0;s<a.length;s++)c.push(a[s]+"="+r[a[s]]);t=t+(t.match(/\?/)?"&":"?")+c.join("&")}var l,u=new XMLHttpRequest;if(u.open(e,t,!0),"GET"!=e&&"DELETE"!=e&&a.length&&(i||u.setRequestHeader("Content-type","application/json")),u.onreadystatechange=function(){4==this.readyState&&(200==this.status?n&&n(this.responseText):o&&o(this.responseText))},"GET"!=e&&"DELETE"!=e&&Object.keys(r).length){if(i)for(var d in l=new FormData,r)l.append(d,r[d]);else l=JSON.stringify(r);u.send(l)}else u.send()}window.addEventListener("DOMContentLoaded",function(){var t=getConsistentPath(location.pathname)+location.search;window.onpopstate=function(e){changePage(e.state.content,e.state.title,e.state.description,e.state.js,e.state.css,t,!0)};var e=createCacheObjectFromFullPage();window.history.replaceState(e,"",t),enableAjaxLinks(),document.querySelector("body").setAttribute("data-path",t)}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},writable:!0,configurable:!0});