window.addEventListener("DOMContentLoaded",loadAdmin);var USER_FIELDS=["first","last","email","password","is_global_admin"],CLASS_FIELDS=["name"],ADMIN_NEW_ROW_VALUES={"/api/user":{id:"new",first:"New",last:"User",email:"",password:"",is_global_admin:0},"/api/class":{id:"new",name:"New Class"}};function loadAdmin(){setUserName(),setActionButtons([{name:"Users",action:function(){loadTable("/api/user",USER_FIELDS)}},{name:"Classes",action:function(){loadTable("/api/class",CLASS_FIELDS)}},{name:LOG_OUT_STRING,action:logout}]),loadTable("/api/user",USER_FIELDS)}function loadTable(l,d){var c=document.querySelector("table");c.innerHTML="",makeRequest("GET",l,{},function(e){try{var t=JSON.parse(e).items;if(t.length){d=d||Object.keys(t[0]);var n=document.createElement("thead"),a=document.createElement("tr");n.appendChild(a);for(var r=0;r<d.length;r++){var i=document.createElement("th");i.innerText=capitalizeFirstLetter(d[r].replace(/_/g," ")),a.appendChild(i)}c.appendChild(n);for(var o=document.createElement("tbody"),r=0;r<t.length;r++)createRow(t[r],d,o,l);createRow(ADMIN_NEW_ROW_VALUES[l],d,o,l),c.appendChild(o)}}catch(e){console.log(e)}})}function createRow(e,t,n,a){var r=document.createElement("tr");r.setAttribute("data-id",e.id);for(var i=0;i<t.length;i++)createCell(t[i],e[t[i]],r,a);n.appendChild(r)}function createCell(e,t,n,l){var d,a=document.createElement("td");a.setAttribute("data-column",e),a.innerText=void 0!==t?t:"",n.appendChild(a),a.onclick=(d=a,function(e){var i,o;d.querySelector("input")||(i=d.innerText,document.body.click(),(o=document.createElement("input")).value=d.innerText,d.innerHTML="",d.appendChild(o),document.body.onclick=function(){if(o.value){d.innerHTML=o.value;var e=d.parentNode.getAttribute("data-id");if("new"===e){for(var t=d.parentNode.querySelectorAll("td"),n={},a=0;a<t.length;a++){var r=t[a].getAttribute("data-column");t[a].innerText?n[r]=Math.random().toString(36).slice(2):n[r]=t[a].innerText}makeRequest("POST",l,n,function(e){var t=JSON.parse(e).id;d.parentNode.setAttribute("data-id",t)},function(){"password"==!d.getAttribute("data-column")&&(d.innerText=i),alert(defaultError)})}else(n={id:e})[d.getAttribute("data-column")]=d.innerHTML,makeRequest("PUT",l,n,function(){},function(){"password"==!d.getAttribute("data-column")&&(d.innerText=i),alert(defaultError)})}else d.innerText=i}),e.stopPropagation()})}